---
title: "实验 006：角色漂移检测"
type: experiment
status: design
date: 2026-02-28
tags:
  - agent
  - self-evolution
  - persona-drift
  - experiment
sources:
  - "Persistent Personas (EACL 2026, arXiv:2512.12775)"
  - "awesome-ai-agent-security 盾卫 Soul Shield"
---

# 实验 006：角色漂移检测

> Agent 是否还是它自己？不靠人工检查，能自动发现吗？

## 问题定义

每个 Agent 有 SOUL.md 定义人格。但人格可能漂移：
1. **文件级漂移**：SOUL.md 被修改（有意或无意）
2. **行为级漂移**：SOUL.md 没变，但实际行为偏离精神

第 1 种简单（hash 比对，盾卫已有 Soul Shield）。第 2 种是真正的难题。

## 理论基础

### Persistent Personas 论文关键发现
- LLM persona fidelity 在 100+ 轮后不可避免衰减
- 功能型 Agent（做任务的）比陪伴型漂移更快
- 漂移方向：趋同于 baseline（无 persona 的默认输出）
- 论文只诊断不治疗

### 贾维斯军团的特殊性
- 每次心跳重新加载 SOUL.md → 理论上每次都是"第 1 轮"
- 但 context window 内的历史消息可能拉偏 → 单 session 内仍可能漂移
- Session reset（每天 04:00）是天然的漂移修复点
- **关键假设**：如果 SOUL.md + HEARTBEAT.md 足够强，短 session 内漂移应该很小

## 检测方案设计

### Level 1：文件完整性（已有）
- 盾卫 Soul Shield：SHA-256 hash 比对
- 检测粒度：文件级（被改了/没被改）
- 足够简单，直接复用

### Level 2：行为特征基线（待实施）

为每个 Agent 建立"行为指纹"：

**哨兵的指纹**：
- 三问过滤执行率（信息是否经过"能帮决策吗/时效/信源"过滤）
- 信号分级准确度（🔴🟡🟢 是否合理）
- 沉默纪律（没东西时是否真的闭嘴，vs 制造垃圾简报）

**学者的指纹**：
- 批判性审查六问是否出现在笔记中
- 三遍读法是否体现（第一遍结构/第二遍论证/第三遍关联）
- 独立判断 vs 盲从论文 claim 的比例

**馆长的指纹**：
- frontmatter 规范执行率
- 交叉链接密度
- 修剪 vs 保留的平衡（是否该删的不删）

### Level 3：漂移趋势分析（远期）

- 每周对比 Agent 产出的语义特征向量
- 检测是否趋同于 baseline（各 Agent 输出越来越像）
- 需要 embedding 基础设施

## 实施路径

1. **Phase 1**（可立即做）：为三个活跃 Agent 各定义 3-5 个行为指纹维度
2. **Phase 2**（中期）：在总管心跳的军团健康检查中，抽查 Agent 最近产出是否符合指纹
3. **Phase 3**（远期）：自动化检测 + 告警

## 与其他实验的关系

- **004 记忆代谢**：规则库中的"不越俎代庖"本身就是一种漂移检测结果——我（贾维斯）的行为漂移到了哨兵的领地
- **003 内生涅槃**：漂移检测可能触发涅槃——当 Agent 发现自己已经不像自己时
- **005 知识共振**：跨 Agent 注入可能导致人格交叉污染（CAPD），006 是防护机制

## 风险与局限

- Level 2 的"行为指纹"定义依赖人工判断，初期不可能完全自动化
- 假阳性风险：Agent 在新场景下的合理行为变化 vs 真正的漂移
- 只有漂移严重到影响产出质量时才有干预价值——轻微漂移可能是"适应"而非"退化"

---

*设计文档。等 Phase 1 行为指纹定义完成后进入 in-progress。*

## 进展记录

### 2026-02-28 Phase 1：行为指纹定义（基于实际产出分析）

通过审查三个活跃 Agent 的 2/28 日志，提取可观测的行为维度：

#### 🔴 哨兵行为指纹

| 维度 | 基线行为 | 漂移信号 |
|------|---------|---------|
| **信源多样性** | 每次扫描覆盖 3+ 独立信源类别 | 反复只查 1-2 个信源 |
| **三问过滤** | 产出中可见决策判断/时效评估/信源评级 | 不加判断地转发原文 |
| **跨域关联** | 日报含"跨板块关联"章节，连接不同领域信号 | 每条新闻独立存在，无关联分析 |
| **沉默纪律** | 无值得报的就 HEARTBEAT_OK | 为刷存在感制造低价值简报 |
| **独立思考** | 能产出如"Layer 3 瓶颈是信任模型"这样的原创洞察 | 只搬运不思考 |

**今日观察（未漂移）**：哨兵在 EXPERIMENT_005 中产出了 Layer 3 分析，将 Anthropic vs Pentagon 映射为 Agent 信任模型问题——这是典型的"独立思考"指标满分表现。

#### 🧠 学者行为指纹

| 维度 | 基线行为 | 漂移信号 |
|------|---------|---------|
| **日产出密度** | 单日 10+ 篇 Vault 笔记（今日 12 篇） | 连续 2 天 < 3 篇 |
| **概念区分精度** | 主动澄清术语歧义（如"Harness Engineering"两种含义） | 混用概念不加区分 |
| **框架构建** | 产出含四象限/谱系/选型决策树等结构化分析 | 只有线性罗列 |
| **跨论文关联** | 发现 VerlTool+RC-GRPO 正交互补这类关系 | 每篇论文独立总结 |
| **老板指令响应** | 当次心跳认领+执行（12:24→12:28 4 分钟响应） | 拖延或忽略 |

**今日观察（未漂移）**：12 篇新笔记、Harness 两义澄清、Credit Assignment 四象限——学者在知识深度上完全符合基线。

#### 📚 馆长行为指纹

| 维度 | 基线行为 | 漂移信号 |
|------|---------|---------|
| **断链修复率** | 主动发现并批量修复（今日 165→13，净修 152 条） | 只做被派的，不主动扫描 |
| **See Also 密度** | 每篇炼化后链接 5+ 相关笔记 | 仅补 frontmatter 不加链接 |
| **质量红线执行** | ASCII 图零容忍、格式规范严格 | 发现违规不纠正 |
| **结构性洞察** | 发现"路径迁移五大方向"等模式 | 只做机械修复 |
| **与学者协同** | 学者写完→馆长炼化→交叉链接闭环 | 积压不炼化 |

**今日观察（未漂移）**：152 条断链修复 + See Also 升级 + 结构性洞察——馆长完全在角色内。

#### 漂移检测触发规则（总管执行）

每周一次（或老板要求时）：
1. 读三 Agent 最近 2 天的 memory/*.md
2. 对照上表 5 个维度逐项检查
3. 任何维度出现"漂移信号" → 标记 ⚠️ 并记录
4. 连续 2 次检查同一维度漂移 → 干预：修改 HEARTBEAT.md 注入矫正指令

**Phase 1 状态**：✅ 三 Agent 行为指纹定义完成，共 15 个维度。今日基线快照已建立（均未漂移）。

### 2026-02-28 观测可信度教训（运维→进化）

今天发现学者实际已心跳（日志与文件 mtime 更新），但 `heartbeat-state.json.lastHeartbeat` 未写回，导致总管侧出现"滞后"误报。

**教训**：漂移检测/健康检测的观测数据应分层：

1. **硬证据（最高可信）**：文件 mtime、输出文件是否生成、git commit/push、外部系统回执
2. **软证据（中可信）**：日志文本（memory/YYYY-MM-DD.md）
3. **自报状态（最低可信）**：heartbeat-state.json 字段

因此 006 的检查流程应默认：
- 先看 lastHeartbeat 作粗筛
- 一旦触发阈值，再用日志/mtime 做二次确认

这同时降低了 watchdog 的误重启风险（避免"重启风暴"）。

**关闭记录（2026-03-01 01:27）**：公告板任务已闭环，学者报告 23:07/00:05/01:05 三次心跳 lastHeartbeat 均正常写回，误报未复现。后续仍按“阈值触发→硬证据二次确认”流程执行。
