---
title: 设计模式总览
type: moc
tags: [design-pattern, architecture, ai-collaboration]
date: 2026-02-28
---

# 设计模式总览

> **目的**：建立架构师视角的思维工具箱。
> 每个模式是**一个经过验证的、解决特定问题的思路**。
> 理解它们，就是掌握系统设计的共同语言。

---

## 完整体系（五层）

```
设计模式全景
│
├── 【第一层】创建型（Creational）     如何造对象
│     简单工厂 / 工厂方法 / 抽象工厂 / 建造者 / 单例 / 原型
│
├── 【第二层】结构型（Structural）     如何组合对象
│     适配器 / 装饰器 / 代理 / 外观 / 桥接 / 组合 / 享元
│
├── 【第三层】行为型（Behavioral，GoF）  对象如何协作
│     观察者 / 策略 / 责任链 / 状态 / 命令
│     中介者 / 模板方法 / 备忘录 / 迭代器 / 访问者
│
├── 【第四层】分布式系统模式            网络环境下的协作
│     弹性：熔断器 / 重试退避 / 舱壁 / 超时
│     数据：事件溯源 / CQRS / Saga
│     治理：API网关 / Sidecar / 服务网格 / 幂等消费者
│     消息：路由器 / 过滤器 / 聚合器 / 散播-聚集
│
└── 【第五层】AI Agent 专属模式         LLM 时代新涌现
      单Agent内：反思 / 计划-执行 / 工具增强 / 记忆增强 / 验证-修复
      多Agent间：移交 / 辩论 / 混合专家 / 分层规划 / 选举共识
```

---

## 文件导航

- [[01-创建型模式]] — 工厂 / 建造者 / 单例 / 原型（6个）
- [[02-结构型模式]] — 适配器 / 装饰器 / 代理 / 外观 / 组合（7个）
- [[03-行为型模式-GoF]] — 观察者 / 策略 / 责任链 / 状态 / 命令 / 中介者（10个）
- [[04-架构模式与AI协作]] — 管道 / 黑板 / 发布订阅 / 监督者 / 蜂群（6个）+ 选型决策树
- [[05-分布式系统模式]] — 熔断器 / Saga / CQRS / 事件溯源 / Sidecar（13个）
- [[06-AI-Agent专属模式]] — 反思 / 计划执行 / 工具增强 / 移交 / 辩论 / MoA（10个）

**总计：52 个模式**

---

## 选模式的心法

问题导向，不是模式导向。先问"我遇到的问题是什么"：

| 问题 | 推荐模式 |
|---|---|
| 怎么造对象，调用方不关心细节 | 工厂系列 |
| 动态给对象加功能，不改原类 | 装饰器 |
| 一件事发生，很多地方响应 | 观察者 / 发布订阅 |
| 有多种算法，运行时切换 | 策略 |
| 请求经过多个处理环节 | 责任链 / 管道 |
| 多组件共享一块数据 | 黑板 |
| 需要总指挥统一协调 | 监督者 / 中介者 |
| 大量同质 Agent 并行 | 蜂群 |
| 下游挂了不能级联崩溃 | 熔断器 |
| 跨服务的事务需要回滚 | Saga |
| 需要完整操作历史 | 事件溯源 |
| LLM 输出质量不够好 | 反思模式 |
| 复杂任务需要全局规划 | 计划-执行 |
| LLM 需要访问外部系统 | 工具增强 |
| 任务到了专业边界需要转交 | 移交模式 |
| 多个模型答案互相验证 | 辩论 / MoA |

---

## AI Agent 协作模式选型决策树

```
新 AI 协作系统怎么设计？

流程固定吗？
  ├─ 是 → 管道-过滤器（RAG / 数据处理 / FARS四阶段）
  └─ 否 → 需要多专家协同渐进求解？
            ├─ 是 → 黑板模式
            └─ 否 → 有中心协调者吗？
                      ├─ 有 → 需要容错/重启？
                      │         ├─ 是 → 监督者模式
                      │         └─ 否 → 中介者 / Master-Worker
                      └─ 没有 → 任务同质可并行？
                                  ├─ 是 → 蜂群
                                  └─ 否 → 发布订阅（事件驱动）

单个 Agent 内部需要提升质量？
  输出可以被验证（代码/SQL/数学）？
    ├─ 是 → 验证-修复循环
    └─ 否 → 反思模式（LLM 自我批评）

任务复杂，需要规划？
  → 计划-执行模式

生产环境，必须加：
  → 熔断器 + 重试退避 + 超时（三件套）
```

---

## 模式进化谱系

```
1994  GoF《设计模式》23 种
        ↓ 代码级
2003  EIP 企业集成模式（Hohpe & Woolf）65 种消息模式
        ↓ 系统集成级
2010s 微服务模式（熔断器/Saga/CQRS/Sidecar）
        ↓ 分布式级
2023+ AI Agent 模式（反思/计划执行/工具增强/移交/辩论/MoA）
        ↓ 智能体级
未来   自适应模式 / 进化模式（Agent 自主发现最优协作结构）
```

---

## 你们军团架构的模式映射

```
用户消息
    ↓
[API 网关]（鉴权/路由）
    ↓
[外观 Facade] = J.A.R.V.I.S. 统一入口
    │
    ├─ [发布订阅] 事件广播
    ├─ [监督者] 健康监控 + 失败重启
    ├─ [策略模式] 动态选择 Agent
    │
    ├─→ Scholar（研究）
    │     ├─ [记忆增强] Vault 检索
    │     ├─ [反思模式] 论文精读迭代
    │     └─ [工具增强] ArXiv/Web 搜索
    │
    ├─→ 贾维斯（执行）
    │     ├─ [计划-执行] 复杂任务分解
    │     └─ [验证-修复] 代码/命令执行验证
    │
    └─→ [黑板模式] bulletin.md / shared/ 共享工作区
              ↕
         各 Agent 协作读写

数据层：
  [事件溯源] heartbeat 日志 + memory/YYYY-MM-DD.md
  [CQRS] 向量检索（读）+ 笔记写入（写）
```
