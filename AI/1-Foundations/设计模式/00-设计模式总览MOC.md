---
title: 设计模式总览
type: moc
tags: [design-pattern, architecture, ai-collaboration]
date: 2026-02-28
brief: 设计模式全景：创建型6种/结构型7种/行为型10种/并发消息稳定性16种，附AI Agent场景映射与选型决策树，共80+个模式与概念。
---

# 设计模式总览

> **目的**：建立架构师视角的思维工具箱。
> 每个模式是**一个经过验证的、解决特定问题的思路**。
> 理解它们，就是掌握系统设计的共同语言。

---

## 完整体系

```mermaid
graph TD
    ROOT[设计模式全景]

    ROOT --> L1[第一层 创建型\n如何造对象]
    L1 --> L1N["简单工厂 / 工厂方法 / 抽象工厂\n建造者 / 单例 / 原型"]

    ROOT --> L2[第二层 结构型\n如何组合对象]
    L2 --> L2N["适配器 / 装饰器 / 代理\n外观 / 桥接 / 组合 / 享元"]

    ROOT --> L3[第三层 行为型 GoF\n对象如何协作]
    L3 --> L3N["观察者 / 策略 / 责任链 / 状态 / 命令\n中介者 / 模板方法 / 备忘录 / 迭代器 / 访问者"]

    ROOT --> L4[第四层 并发与消息\n多线程与网络协调]
    L4 --> L4N["同步原语：互斥锁/读写锁/信号量/条件变量\n并发：生产者消费者/扇出扇入/Reactor\n消息：发布订阅/推拉\n稳定性：熔断器/重试/舱壁/限流/快速失败"]

    ROOT --> L5[第五层 分布式系统\n网络环境下的协作]
    L5 --> L5N["弹性：熔断器/重试/舱壁/超时\n数据：事件溯源/CQRS/Saga\n治理：API网关/Sidecar/服务网格"]

    ROOT --> L6[第六层 AI Agent 专属\nLLM 时代新涌现]
    L6 --> L6N["单Agent：反思/计划执行/工具增强/记忆增强\n多Agent：移交/辩论/MoA/蜂群/监督者"]

    ROOT --> L7[第七层 架构风格与演化\n系统的宏观形状]
    L7 --> L7N["风格：分层/六边形/事件驱动/微核/DDD\n演化：绞杀者/特性开关/蓝绿/金丝雀\n原则：SOLID/DRY/YAGNI"]

    ROOT --> L8[第八层 AI工程实践 LLMOps\n生产环境存活能力]
    L8 --> L8N["Prompt：Few-Shot/CoT/版本管理\nRAG：分块/重排/评测RAGAS\n护栏：输入输出过滤/Prompt Injection防护\n运维：追踪/成本监控/降级"]
```

---

## 文件导航

- [[01-创建型模式]] — 工厂 / 建造者 / 单例 / 原型（6个）
- [[02-结构型模式]] — 适配器 / 装饰器 / 代理 / 外观 / 组合（7个）
- [[03-行为型模式-GoF]] — 观察者 / 策略 / 责任链 / 状态 / 命令 / 中介者（10个）
- [[04-架构模式与AI协作]] — 管道 / 黑板 / 发布订阅 / 监督者 / 蜂群（6个）+ 选型决策树
- [[05-分布式系统模式]] — 熔断器 / Saga / CQRS / 事件溯源 / Sidecar（13个）
- [[06-AI-Agent专属模式]] — 反思 / 计划执行 / 工具增强 / 移交 / 辩论 / MoA（10个）
- [[07-架构风格与演化模式]] — 六边形 / EDA / DDD / 绞杀者 / 蓝绿 / 金丝雀 / SOLID（15个概念）
- [[08-AI工程实践模式-LLMOps]] — Prompt管理 / RAG工程 / 评测 / 护栏 / 可观测性（15个）
- [[09-并发与消息模式]] — 同步原语 / 并发 / 消息传递 / 稳定性（16个）⭐ 新增

**总计：90+ 个模式与概念，覆盖从代码到生产的完整体系**

---

## 选模式的心法

问题导向，不是模式导向。先问"我遇到的问题是什么"：

| 问题 | 推荐模式 |
|---|---|
| 怎么造对象，调用方不关心细节 | 工厂系列 |
| 动态给对象加功能，不改原类 | 装饰器 |
| 一件事发生，很多地方响应 | 观察者 / 发布订阅 |
| 有多种算法，运行时切换 | 策略 |
| 请求经过多个处理环节 | 责任链 / 管道 |
| 多组件共享一块数据 | 黑板 |
| 需要总指挥统一协调 | 监督者 / 中介者 |
| 大量同质 Agent 并行 | 蜂群 |
| 下游挂了不能级联崩溃 | 熔断器 |
| 跨服务的事务需要回滚 | Saga |
| 需要完整操作历史 | 事件溯源 |
| LLM 输出质量不够好 | 反思模式 |
| 复杂任务需要全局规划 | 计划-执行 |
| LLM 需要访问外部系统 | 工具增强 |
| 任务到了专业边界需要转交 | 移交模式 |
| 多个模型答案互相验证 | 辩论 / MoA |
| 多线程访问共享资源 | 互斥锁 / 读写锁 |
| 控制并发数量上限 | 信号量 / 有界并行 |
| 生产速度与消费速度不匹配 | 生产者-消费者 |
| 对外调用需要限速保护 | 限流 + 熔断器 + 重试（三件套） |

---

## AI Agent 协作模式选型决策树

```mermaid
flowchart TD
    START[新 AI 协作系统怎么设计？]

    START --> Q1{流程是否固定？}
    Q1 -->|是| PIPE[管道-过滤器\nRAG数据处理FARS四阶段]
    Q1 -->|否| Q2{需要多专家协同渐进求解？}
    Q2 -->|是| BB[黑板模式]
    Q2 -->|否| Q3{有中心协调者吗？}
    Q3 -->|有| Q4{需要容错和重启？}
    Q4 -->|是| SUP[监督者模式]
    Q4 -->|否| MED[中介者\nMaster-Worker]
    Q3 -->|没有| Q5{任务同质可并行？}
    Q5 -->|是| SWARM[蜂群]
    Q5 -->|否| PUBSUB[发布订阅\n事件驱动]

    QUALITY[单 Agent 需要提升质量？]
    QUALITY --> Q6{输出可验证？代码SQL数学}
    Q6 -->|可以| VR[验证-修复循环]
    Q6 -->|不能| REF[反思模式\nLLM自我批评]

    COMPLEX[任务复杂，需要规划？]
    COMPLEX --> PE[计划-执行模式]

    PROD[生产环境三件套]
    PROD --> THREE["熔断器 + 重试退避 + 超时\n缺一不可"]
```

---

## 模式进化谱系

```mermaid
flowchart TD
    G94["1994 GoF《设计模式》23 种\n代码级：创建/结构/行为"]
    EIP["2003 EIP 企业集成模式\n65 种消息模式\n系统集成级"]
    MSV["2010s 微服务模式\n熔断器/Saga/CQRS/Sidecar\n分布式级"]
    AI23["2023+ AI Agent 模式\n反思/计划执行/工具增强/移交/辩论/MoA\n智能体级"]
    FUT["未来：自适应模式\nAgent 自主发现最优协作结构"]

    G94 --> EIP --> MSV --> AI23 --> FUT
```

---

## 军团架构的模式映射

```mermaid
flowchart TD
    USER[用户消息] --> GW[API 网关\n鉴权路由]
    GW --> JV[贾维斯 Facade\n统一入口\n外观模式]

    JV -->|事件广播| PS[发布订阅总线]
    JV -->|健康监控| SUP[监督者模式]
    JV -->|动态选Agent| STR[策略模式]

    PS --> SCH[Scholar 研究]
    PS --> LIB[馆长 Librarian]
    PS --> SEN[哨兵 Sentinel]

    SCH --> MA[记忆增强\nVault检索]
    SCH --> REF[反思模式\n论文精读迭代]
    SCH --> TA[工具增强\nArXiv搜索]

    JV --> BB[黑板模式\nbulletin.md共享工作区]
    BB <--> SCH & LIB

    subgraph 数据层
        ES[事件溯源\nheartbeat日志memory日志]
        CQRS_note[CQRS\n向量检索读+笔记写入写]
    end
```

---

## 参考资料

- GoF《设计模式：可复用面向对象软件的基础》1994
- 《企业集成模式》Hohpe & Woolf 2003
- <https://github.com/onexstack/design-pattern> — 58种模式Go实现
- [[09-并发与消息模式]] — 同步/并发/消息/稳定性扩展
