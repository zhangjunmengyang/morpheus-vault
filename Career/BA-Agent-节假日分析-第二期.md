---
title: BA Agent 节假日分析 第二期
type: project-note
domain: career/agent
date: 2026-02-28
updated: 2026-02-28
tags:
  - BA-Agent
  - 后训练
  - SFT
  - AgentRL
  - 评测自动化
  - 数据洞察
  - 节假日分析
  - 商业分析
status: active
brief: >
  在第一期节假日复盘 BA Agent 基础上，第二期聚焦泛化能力提升与工程效率优化，通过 SFT+AgentRL 后训练将自研模型评测得分从 55 提升至 60 分（接近行业主流水平）。核心技术亮点包括：引入「数据裁剪+策略标注」实现业务策略驱动的深度洞察，DAG 并行调度大幅压缩报告产出时间，以及三类评测题型自动化方案（准确率 100%/95%/80%+）。项目目标是将 BA 分析知识解耦，使其在营销复盘等新场景低成本可复用。
---

## 背景与目标

### 背景：第一期暴露的关键问题

第一期 BA Agent 在**数据准确度**和**分析覆盖度**上基本达标，但暴露出四个核心问题：

1. **泛化性不足**：Agent 生产的 Prompt 过长，依赖研发配置上线，BA/算法/工程三方角色能力未解耦
2. **分析洞察不够**：分析结论缺少与内部策略动作及外部环境的关联，模型缺少业务背景知识，对指标表现判断力不足
3. **模型能力不足**：商用开源模型指令遵循能力受限，需要大量定制化 Prompt，亟需后训练垂类模型解决幻觉问题
4. **报告产出耗时长**：各专题（用户流量/供给/区域等）串行执行，单篇报告耗时 2h+，多业务分析时线性增长

### 目标

解耦 BA 分析知识，在营销复盘等新场景低成本复用、泛化；探索结合业务策略的数据洞察能力；持续打磨算法后训练能力，沉淀垂类分析模型。

---

## 分析效果增强

### 遵循与下钻分析能力提升（后训练）

**核心成果**：通过 SFT + AgentRL 后训练，自研模型评测得分从 **~55 分提升至 ~60 分**（春节场景），整体接近行业主流水平。

| 场景 | 训练前 | 训练后 |
|------|--------|--------|
| 春节  | 55 分  | 60 分  |
| 520  | 56 分  | 59 分  |

**技术方案**：聚焦 BA 场景对数据获取/计算和分析下钻的特殊要求（高精度计算、强逻辑分析、低幻觉），联合构建了**多工具调用与报告生成的自适应工具调用训练**，训练流程包括：

- 少量数据样本下跑通 SFT 流程
- AgentRL 强化学习优化工具调用策略
- 显著提升复杂指令遵循和工具调用效率

**评测框架升级**：从评估「报告还原度」→ 升级为评估「**报告可用水平**」。

- 部分维度基准与商分报告解耦，改为预设得分点
- 增加「下钻逻辑性」「结论可靠性」等高阶评测维度，体现模型区分度

### 业务策略结合分析深度（洞察增强）

**核心问题**：报告深度不足，缺乏洞察性结论；报告废话多，分析侧重点不足。

**解决方案**：设计多组对照实验，验证不同「策略信息注入」方案效果。

**实验结论**：在"单表分析环节"中，**「数据裁剪 + 策略标注」组合**为当前最优解。

| 策略 | 效果 |
|------|------|
| 数据裁剪 | 预先过滤仅保留与策略强相关的表，有效减少过度归因 |
| 策略标注 | 显式列出策略的作用时间、业务范围、影响指标维度，比抽象策略更易被模型理解 |
| 注入环节限制 | 仅在「单表分析」环节注入效果最佳，其他环节注入效果不明显 |

**泛化路径**：打通知识库（维护中长期策略）+ query 注入（临时策略）；自动裁剪分析路径结合业务策略做 Prompt 优化。

**工程局限性**：新场景泛化成本约 1 周，整体策略准确性约 80%，仍存在过度归因和幻觉问题。

**后续方向**：同步试点微调方案，将策略标注进训练数据集，使中长期策略内化到模型，从模型层面提升结论深度。

---

## 场景泛化

### 内容与框架解耦

**核心改造**：将分析知识库与分析框架解绑，实现可插拔架构。

- **知识库解耦**：数据集、知识库（数仓元数据/业务知识/策略知识）与分析子 Agent 解耦，升级为可插拔模型
- **报告格式解耦**：同一场景支持不同业务线的报告格式差异化配置（默认模板 + 自定义配置）

**价值**：BA 沉淀的分析知识可在新场景低成本复用，无需研发重新配置上线。

---

## 链路效率提升

### 底层框架升级：串行 → 并行调度

引入 **DAG 规划器**，在调度前完成规划路径拆解，可并行步骤并行执行，显著减少等待时间，解决 2h+ 报告产出耗时问题。

### 产品迭代：Agent 生产协作平台

提供 BA 与研发的低成本高效协作平台，BA 可最小化改动成本完成新场景泛化配置，减少对研发的依赖。

---

## 评测自动化

根据评测集形态差异，设计三类自动化方案，**全部跑通**：

| 题型 | 方案 | 准确率 | 状态 |
|------|------|--------|------|
| 封闭式客观题 | LLM as Judge，依据标准答案和评分标准自动打分 | **~100%** | 已在原节假日场景上线 |
| 半封闭式客观题 | 两阶段：得分点自动识别 + 匹配评分 | **95%** | 已在「指标全面性」跑通 |
| 开放式主观题 | 「多 Agent 共识」机制，联合评审团模拟专家评审 | **80%+** | 已在「结论可靠性」跑通，调优中 |

**评测框架规划**：借鉴 Xbench，设计「**基础能力水平**」和「**业务可用水平**」双轨评估体系，互相独立、互为补充。基础能力水平覆盖：专业技能（分析思路/数据获取/数据处理/方法应用/可视化）+ 通用能力（写作论述/逻辑推理）。

**规模化效益**：自动化前每份报告人工评测成本约 1.5-2 pd，自动化后大幅降低，支撑技术快速迭代。

---

## 问题与优化方向

### 当前核心问题

| 问题 | 根因 | 探索方向 |
|------|------|----------|
| Text2SQL 取数准确率低（~80%） | 复杂 SQL 生成难度大 | 以 Text2Param 为主 + SQL 降级兜底；贡献度/同环比等改为取数后算子；优先推荐已有 Dashboard |
| 分析深度不足，洞察少 | 模型缺业务策略上下文 | 知识库注入策略（已验证）；增加 Search 工具检索外部信息；后训练内化存量分析报告 |
| 分析内容多，侧重点不突出 | Planning 阶段未关联策略 | Planning 阶段通过策略关联控制分析主题宽度；子 Agent 强化引导聚焦结论；总结阶段剔除无效结论 |
| 泛化效率低 | BA 知识与 Prompt 耦合 | BA 沉淀最小化知识库自动转为可执行分析 Prompt；后训练将业务知识内化模型 |
| 算法后训练效率低 | 标注和合成效率低，对齐成本高 | 探索少样本合成数据方案；标注平台升级引入 AI 辅助人工标注 |
| 评测通用性不足 | 评测体系单一 | 双轨评估体系（基础能力水平 + 业务可用水平）；参考司内商分能力矩阵构建评测集 |

---

## See Also

- [[Career/BA-Agent-节假日分析-第一期]]
- [[Career/BA-Agent-节假日分析-夏战场景]]
